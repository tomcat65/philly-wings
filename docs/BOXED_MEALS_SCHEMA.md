# Boxed Meals Collection Schema

## Overview
The `boxedMeals` collection stores configured boxed meal orders for corporate catering. Each document represents a complete order with individual box configurations.

## Collection: `boxedMeals`

### Document ID
Auto-generated by Firestore or custom order ID (e.g., `BM-2025-10-17-001`)

### Schema Structure

```javascript
{
  // Order Metadata
  orderId: string,                    // Unique identifier
  orderDate: timestamp,               // When order was placed
  deliveryDate: timestamp,            // Requested delivery date
  status: string,                     // 'pending' | 'confirmed' | 'preparing' | 'delivered' | 'cancelled'

  // Customer Information
  customer: {
    name: string,
    email: string,
    phone: string,
    company: string,
    deliveryAddress: {
      street: string,
      city: string,
      state: string,
      zip: string,
      instructions: string            // Optional delivery notes
    }
  },

  // Order Configuration
  boxCount: number,                   // Total number of boxes (min: 10)
  bulkConfiguration: {                // Applied to all boxes by default
    wingType: string,                 // 'boneless' | 'bone-in' | 'plant-based'
    sauceId: string,                  // Reference to sauces collection
    dips: string[],                   // Array of 2 dip IDs ['ranch', 'blue-cheese']
    sideId: string,                   // 'chips' | reference to coldSides collection
    dessertId: string                 // Reference to desserts collection
  },

  // Individual Box Customizations (optional)
  individualBoxes: [                  // Only present if boxes differ from bulk config
    {
      boxNumber: number,              // 1-indexed box number
      wingType: string,
      sauceId: string,
      dips: string[],
      sideId: string,
      dessertId: string,
      specialInstructions: string     // Optional per-box notes
    }
  ],

  // Pricing
  pricing: {
    pricePerBox: number,              // Base price per box
    subtotal: number,                 // boxCount * pricePerBox
    deliveryFee: number,
    tax: number,
    total: number
  },

  // Order Source
  source: {
    platform: string,                 // 'direct' | 'ezcater'
    referenceId: string               // External platform order ID if applicable
  },

  // Special Requests
  specialRequests: string,            // Customer notes

  // Timestamps
  createdAt: timestamp,
  updatedAt: timestamp
}
```

## Field Descriptions

### Wing Types
- `boneless`: Boneless wings (most popular for boxed meals)
- `bone-in`: Traditional bone-in wings
- `plant-based`: Cauliflower wings (fried or baked)

### Sauce References
- `sauceId` references documents in the `sauces` collection
- Each box gets ONE sauce flavor
- Multiple boxes can have different sauces

### Dips Configuration
- Each box includes exactly 2 dips (1.5oz cups each)
- Valid values: `ranch`, `blue-cheese`, `honey-mustard`
- Stored as array: `['ranch', 'blue-cheese']`

### Side Options
- `chips`: Miss Vickie's Chips (Variety Pack)
  - UPC: 2840077535
  - Item #30543 (Restaurant Depot)
- References to `coldSides` collection:
  - `coleslaw`: Sally Sherman Coleslaw
  - `potato-salad`: Sally Sherman Potato Salad
- **Note**: NO FRIES - they don't travel well in boxed meals

### Dessert References
- `dessertId` references documents in the `desserts` collection
- Each box includes ONE individual-serving dessert
- Common options:
  - Cheesecake slice
  - Brownie
  - Pound cake slice

### Order Status Flow
1. `pending`: Quote requested, awaiting confirmation
2. `confirmed`: Order confirmed, payment processed
3. `preparing`: Kitchen preparing order
4. `delivered`: Order delivered successfully
5. `cancelled`: Order cancelled

## Related Collections

### Primary References
- `sauces` - Wing sauce options (14 signature flavors)
- `desserts` - Individual dessert servings
- `coldSides` - Travel-friendly cold sides
- `plantBasedWings` - Cauliflower wing variants

### Menu Items Reference
- Bottled water automatically included (from `menuItems` drinks category)
- Chips reference: Item #30543 in future `sides` collection

## Indexes Required

```javascript
// Composite index for order queries
[
  { field: 'status', order: 'asc' },
  { field: 'deliveryDate', order: 'asc' }
]

// Customer lookup
[
  { field: 'customer.email', order: 'asc' },
  { field: 'createdAt', order: 'desc' }
]

// Date range queries
[
  { field: 'deliveryDate', order: 'asc' },
  { field: 'createdAt', order: 'desc' }
]
```

## Business Rules

### Minimum Order
- Minimum 10 boxes per order
- Maximum 500 boxes per order (recommend 48hr notice for 80+)

### Bulk Configuration
- When all boxes are identical, only `bulkConfiguration` is stored
- `individualBoxes` array only populated when customizations exist
- Reduces data size for large uniform orders

### Pricing Strategy
- `pricePerBox`: Base price (shown on website)
- Platform markup applied for ezCater orders (35%)
- Delivery fee based on distance and order size
- Tax calculated at checkout

### Lead Time
- 24-hour minimum advance notice
- 48-hour recommended for orders of 80+ boxes
- Rush orders (same-day) not available for boxed meals

## Example Documents

### Simple Order (All Boxes Identical)
```javascript
{
  orderId: "BM-2025-10-17-001",
  orderDate: "2025-10-17T10:00:00Z",
  deliveryDate: "2025-10-18T12:00:00Z",
  status: "confirmed",

  customer: {
    name: "John Smith",
    email: "john@techcorp.com",
    phone: "(215) 555-0100",
    company: "TechCorp Inc",
    deliveryAddress: {
      street: "1234 Market St, Suite 500",
      city: "Philadelphia",
      state: "PA",
      zip: "19107",
      instructions: "Call when arriving, elevator to 5th floor"
    }
  },

  boxCount: 20,
  bulkConfiguration: {
    wingType: "boneless",
    sauceId: "honey-hot",
    dips: ["ranch", "honey-mustard"],
    sideId: "chips",
    dessertId: "chocolate-brownie"
  },

  pricing: {
    pricePerBox: 15.99,
    subtotal: 319.80,
    deliveryFee: 25.00,
    tax: 27.58,
    total: 372.38
  },

  source: {
    platform: "direct",
    referenceId: null
  },

  specialRequests: "One vegetarian box with plant-based wings",

  createdAt: "2025-10-17T10:00:00Z",
  updatedAt: "2025-10-17T10:00:00Z"
}
```

### Complex Order (Mixed Configurations)
```javascript
{
  orderId: "BM-2025-10-17-002",
  boxCount: 50,

  bulkConfiguration: {
    wingType: "boneless",
    sauceId: "buffalo",
    dips: ["ranch", "blue-cheese"],
    sideId: "chips",
    dessertId: "cheesecake"
  },

  // Override specific boxes
  individualBoxes: [
    {
      boxNumber: 15,
      wingType: "plant-based",
      sauceId: "garlic-parm",
      dips: ["ranch", "honey-mustard"],
      sideId: "coleslaw",
      dessertId: "cheesecake",
      specialInstructions: "Vegan - no dairy dips"
    },
    {
      boxNumber: 23,
      wingType: "boneless",
      sauceId: "mild",
      dips: ["ranch", "ranch"],  // Double ranch request
      sideId: "chips",
      dessertId: "pound-cake",
      specialInstructions: "No spice allergy"
    }
  ],

  specialRequests: "Box 15 is for vegetarian team member, ensure completely separate preparation"
}
```

## Migration Notes

### Creating the Collection
Collection does not need to be created in advance - Firestore will create it on first document write.

### Security Rules
```javascript
match /boxedMeals/{orderId} {
  // Public read for order tracking
  allow read: if request.auth != null;

  // Only admin can create/update
  allow create, update: if request.auth.token.admin == true;

  // Only admin can delete
  allow delete: if request.auth.token.admin == true;
}
```

## Query Examples

### Get pending orders for today
```javascript
const today = new Date();
today.setHours(0, 0, 0, 0);

const q = query(
  collection(db, 'boxedMeals'),
  where('status', '==', 'pending'),
  where('deliveryDate', '>=', today),
  orderBy('deliveryDate', 'asc')
);
```

### Get customer order history
```javascript
const q = query(
  collection(db, 'boxedMeals'),
  where('customer.email', '==', 'john@techcorp.com'),
  orderBy('createdAt', 'desc'),
  limit(10)
);
```

### Get large orders (80+ boxes)
```javascript
const q = query(
  collection(db, 'boxedMeals'),
  where('boxCount', '>=', 80),
  where('status', '==', 'confirmed'),
  orderBy('boxCount', 'desc')
);
```

## Future Enhancements

### Planned Features
1. **Nutrition Tracking**: Link to Erika's nutrition database for allergen reporting
2. **Inventory Management**: Track ingredient usage per order
3. **Driver Assignment**: Add delivery tracking fields
4. **Customer Accounts**: Link to user profiles for faster repeat orders
5. **Favorites**: Save common configurations for quick reorder
6. **Group Orders**: Allow team members to customize their own boxes

### Analytics Fields (Future)
```javascript
analytics: {
  preparationTime: number,        // Minutes to prepare
  actualDeliveryTime: timestamp,  // When actually delivered
  customerRating: number,         // 1-5 stars
  feedback: string
}
```
